<script>
  (function () {
    const STORAGE_KEY = "kairosFlexWeeklyHoursIncomeModes_v3";
    const WEEK_LIMIT = 40;
    const DAY_NAMES = [
      "Domingo",
      "Lunes",
      "Martes",
      "Miércoles",
      "Jueves",
      "Viernes",
      "Sábado"
    ];

    const startDaySelect = document.getElementById("startDay");
    const daysContainer = document.getElementById("daysContainer");
    const usedHoursEl = document.getElementById("usedHours");
    const remainingHoursEl = document.getElementById("remainingHours");
    const warningTextEl = document.getElementById("warningText");

    const amazonTotalEl = document.getElementById("amazonTotal");
    const otherTotalEl = document.getElementById("otherTotal");
    const cashTipsTotalEl = document.getElementById("cashTipsTotal");
    const grandTotalEl = document.getElementById("grandTotal");
    const avgRateEl = document.getElementById("avgRate");

    const resetWeekBtn = document.getElementById("resetWeek");
    const exportPdfBtn = document.getElementById("exportPdf");
    const exportCsvBtn = document.getElementById("exportCsv");

    // ⚠️ solo la declaramos aquí; la inicializamos en init()
    let themeSelect = null;

    let state = {
      startIndex: 0, // 0 = Domingo
      blocks: {},    // "day_0": [horasBloque0,1,2]
      blockPayments: {}, // "day_0": [pagoBloque0,1,2]
      earnings: {},  // "day_0": { amazon, shipt, spark, veho, other, tips }
      modes: {}      // "day_0": "flex" | "multi"
    };

    /* =========================
       THEME / TEMA
    ==========================*/

    function applyTheme(theme) {
      const root = document.documentElement;

      const themes = {
        cyan: {
          accent: "#22d3ee",
          soft: "rgba(34, 211, 238, 0.2)"
        },
        red: {
          accent: "#f43f5e",
          soft: "rgba(244, 63, 94, 0.2)"
        },
        purple: {
          accent: "#a855f7",
          soft: "rgba(168, 85, 247, 0.2)"
        },
        gray: {
          accent: "#94a3b8",
          soft: "rgba(148, 163, 184, 0.2)"
        }
      };

      const t = themes[theme] || themes.cyan;
      root.style.setProperty("--accent", t.accent);
      root.style.setProperty("--accent-soft", t.soft);

      localStorage.setItem("kairos_theme", theme);
    }

    function loadTheme() {
      const saved = localStorage.getItem("kairos_theme") || "cyan";
      if (themeSelect) {
        themeSelect.value = saved;
      }
      applyTheme(saved);
    }

    /* =========================
       STATE / LOCALSTORAGE
    ==========================*/

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (typeof parsed === "object" && parsed !== null) {
          if (typeof parsed.startIndex === "number") {
            state.startIndex = parsed.startIndex;
          }
          if (typeof parsed.blocks === "object" && parsed.blocks !== null) {
            state.blocks = parsed.blocks;
          }
          if (typeof parsed.blockPayments === "object" && parsed.blockPayments !== null) {
            state.blockPayments = parsed.blockPayments;
          }
          if (typeof parsed.earnings === "object" && parsed.earnings !== null) {
            state.earnings = parsed.earnings;
          }
          if (typeof parsed.modes === "object" && parsed.modes !== null) {
            state.modes = parsed.modes;
          }
        }
      } catch (e) {
        console.warn("No se pudo cargar el estado:", e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn("No se pudo guardar el estado:", e);
      }
    }

    /* =========================
       HELPERS
    ==========================*/

    function createDayOrder(startIndex) {
      const order = [];
      for (let i = 0; i < 7; i++) {
        const idx = (startIndex + i) % 7;
        order.push({
          realIndex: idx,
          label: DAY_NAMES[idx],
          key: "day_" + idx
        });
      }
      return order;
    }

    function applyModeStyle(card, dayKey) {
      const mode = state.modes[dayKey] || "flex";
      card.classList.remove("mode-flex", "mode-multi");
      if (mode === "multi") {
        card.classList.add("mode-multi");
      } else {
        card.classList.add("mode-flex");
      }
      const btn = card.querySelector(".mode-btn");
      if (btn) {
        btn.textContent = mode === "multi" ? "Multiapp" : "Solo Flex";
      }
    }

    function ensureEarningsDay(dayKey) {
      if (!state.earnings[dayKey]) {
        state.earnings[dayKey] = {
          amazon: 0,
          shipt: 0,
          spark: 0,
          veho: 0,
          other: 0,
          tips: 0
        };
      } else {
        const e = state.earnings[dayKey];
        if (typeof e.amazon !== "number") e.amazon = 0;
        if (typeof e.shipt !== "number") e.shipt = 0;
        if (typeof e.spark !== "number") e.spark = 0;
        if (typeof e.veho !== "number") e.veho = 0;
        if (typeof e.other !== "number") e.other = 0;
        if (typeof e.tips !== "number") e.tips = 0;
      }
    }

    function ensureBlockPaymentsDay(dayKey) {
      if (!state.blockPayments[dayKey]) {
        state.blockPayments[dayKey] = [0, 0, 0];
      } else if (!Array.isArray(state.blockPayments[dayKey])) {
        state.blockPayments[dayKey] = [0, 0, 0];
      } else {
        const arr = state.blockPayments[dayKey];
        for (let i = 0; i < 3; i++) {
          if (typeof arr[i] !== "number") arr[i] = 0;
        }
      }
    }

    /* =========================
       UI: TARJETAS POR DÍA
    ==========================*/

    function createDayCard(dayMeta) {
      const card = document.createElement("article");
      card.className = "day-card";
      card.dataset.dayKey = dayMeta.key;

      const currentMode = state.modes[dayMeta.key] || "flex";
      state.modes[dayMeta.key] = currentMode;

      const header = document.createElement("div");
      header.className = "day-header";

      const headerTop = document.createElement("div");
      headerTop.className = "day-header-top";

      const name = document.createElement("div");
      name.className = "day-name";
      name.textContent = dayMeta.label;

      const modeToggle = document.createElement("div");
      modeToggle.className = "mode-toggle";

      const modeLabel = document.createElement("span");
      modeLabel.className = "mode-label";
      modeLabel.textContent = "Modo";

      const modeBtn = document.createElement("button");
      modeBtn.type = "button";
      modeBtn.className = "mode-btn";
      modeBtn.dataset.dayMode = dayMeta.key;

      modeToggle.appendChild(modeLabel);
      modeToggle.appendChild(modeBtn);

      headerTop.appendChild(name);
      headerTop.appendChild(modeToggle);

      const headerMeta = document.createElement("div");
      headerMeta.className = "day-meta";
      headerMeta.innerHTML = `
        <span>Horas: <strong data-day-total-hours="${dayMeta.key}">0</strong> h</span>
        <span>Ingresos: <strong data-day-total-money="${dayMeta.key}">$0.00</strong></span>
      `;

      header.appendChild(headerTop);
      header.appendChild(headerMeta);

      // BLOQUES
      const blocksSectionLabel = document.createElement("div");
      blocksSectionLabel.className = "section-label";
      blocksSectionLabel.textContent = "Bloques de horas (Flex)";

      const blocks = document.createElement("div");
      blocks.className = "blocks";

      const hourLabels = ["Madrugada", "Tarde", "Noche"];
      const savedBlocks = state.blocks[dayMeta.key];
      const savedBlockPayments = state.blockPayments[dayMeta.key];

      hourLabels.forEach((lbl, idx) => {
        const row = document.createElement("div");
        row.className = "block-row";

        const lab = document.createElement("label");
        lab.textContent = lbl;

        const select = document.createElement("select");
        select.dataset.dayKey = dayMeta.key;
        select.dataset.blockIndex = String(idx);

        const options = [
          { label: "0 h", value: "" },
          { label: "2 h", value: "2" },
          { label: "2.5 h", value: "2.5" },
          { label: "3 h", value: "3" },
          { label: "3.5 h", value: "3.5" },
          { label: "4 h", value: "4" }
        ];

        options.forEach(opt => {
          const optionEl = document.createElement("option");
          optionEl.value = opt.value;
          optionEl.textContent = opt.label;
          select.appendChild(optionEl);
        });

        if (Array.isArray(savedBlocks) && typeof savedBlocks[idx] === "number" && savedBlocks[idx] > 0) {
          select.value = String(savedBlocks[idx]);
        }

        select.addEventListener("change", onHoursSelectChange);

        const priceInput = document.createElement("input");
        priceInput.type = "number";
        priceInput.min = "0";
        priceInput.step = "0.01";
        priceInput.placeholder = "$0.00";
        priceInput.dataset.dayKey = dayMeta.key;
        priceInput.dataset.blockIndex = String(idx);

        if (Array.isArray(savedBlockPayments) && typeof savedBlockPayments[idx] === "number") {
          priceInput.value = savedBlockPayments[idx];
        }

        priceInput.addEventListener("input", onBlockPriceInput);

        row.appendChild(lab);
        row.appendChild(select);
        row.appendChild(priceInput);
        blocks.appendChild(row);
      });

      // INGRESOS
      const earningsSectionLabel = document.createElement("div");
      earningsSectionLabel.className = "section-label";
      earningsSectionLabel.textContent = "Ingresos del día";

      const earnings = document.createElement("div");
      earnings.className = "earnings";

      const earningFields = [
        { key: "amazon", label: "Amazon Flex (extra/ajustes)", nonAmazon: false },
        { key: "shipt", label: "Shipt", nonAmazon: true },
        { key: "spark", label: "Spark", nonAmazon: true },
        { key: "veho", label: "Veho", nonAmazon: true },
        { key: "other", label: "Otros", nonAmazon: true },
        { key: "tips", label: "Tips efectivo", nonAmazon: true }
      ];

      const savedEarnings = state.earnings[dayMeta.key] || {};

      earningFields.forEach(field => {
        const row = document.createElement("div");
        row.className = "earning-row";
        if (field.nonAmazon) {
          row.dataset.nonAmazon = "true";
        }

        const lab = document.createElement("label");
        lab.textContent = field.label;

        const input = document.createElement("input");
        input.type = "number";
        input.min = "0";
        input.step = "0.01";
        input.placeholder = "0.00";
        input.dataset.dayKey = dayMeta.key;
        input.dataset.earningKey = field.key;

        if (savedEarnings && typeof savedEarnings[field.key] === "number") {
          input.value = savedEarnings[field.key];
        }

        input.addEventListener("input", onEarningInput);

        row.appendChild(lab);
        row.appendChild(input);
        earnings.appendChild(row);
      });

      card.appendChild(header);
      card.appendChild(blocksSectionLabel);
      card.appendChild(blocks);
      card.appendChild(earningsSectionLabel);
      card.appendChild(earnings);

      modeBtn.addEventListener("click", () => {
        const current = state.modes[dayMeta.key] || "flex";
        const next = current === "flex" ? "multi" : "flex";
        state.modes[dayMeta.key] = next;
        applyModeStyle(card, dayMeta.key);
        saveState();
      });

      applyModeStyle(card, dayMeta.key);

      return card;
    }

    /* =========================
       EVENTOS DE INPUT
    ==========================*/

    function onHoursSelectChange(evt) {
      const select = evt.target;
      const dayKey = select.dataset.dayKey;
      const blockIndex = parseInt(select.dataset.blockIndex, 10);

      if (!state.blocks[dayKey]) {
        state.blocks[dayKey] = [0, 0, 0];
      }

      let val = 0;
      if (select.value !== "") {
        const num = parseFloat(select.value);
        if (!isNaN(num) && num > 0) {
          val = num;
        }
      }

      state.blocks[dayKey][blockIndex] = val;
      recalcTotals();
      saveState();
    }

    function onBlockPriceInput(evt) {
      const input = evt.target;
      const dayKey = input.dataset.dayKey;
      const blockIndex = parseInt(input.dataset.blockIndex, 10);

      ensureBlockPaymentsDay(dayKey);

      let valueStr = String(input.value || "").replace(",", ".");
      let val = parseFloat(valueStr);
      if (isNaN(val) || val < 0) val = 0;

      state.blockPayments[dayKey][blockIndex] = val;
      recalcTotals();
      saveState();
    }

    function onEarningInput(evt) {
      const input = evt.target;
      const dayKey = input.dataset.dayKey;
      const earningKey = input.dataset.earningKey;

      ensureEarningsDay(dayKey);

      let valueStr = String(input.value || "").replace(",", ".");
      let val = parseFloat(valueStr);
      if (isNaN(val) || val < 0) val = 0;

      state.earnings[dayKey][earningKey] = val;
      recalcTotals();
      saveState();
    }

    /* =========================
       CÁLCULOS
    ==========================*/

    function computeSummary() {
      let weeklyHours = 0;
      const dayHoursTotals = {};
      const dayMoneyTotals = {};

      let totalAmazon = 0;
      let totalApps = 0;
      let totalTips = 0;

      for (let i = 0; i < 7; i++) {
        const dayKey = "day_" + i;

        const blocks = state.blocks[dayKey] || [0, 0, 0];
        const dayHours = blocks.reduce(
          (acc, v) => acc + (typeof v === "number" ? v : 0),
          0
        );
        dayHoursTotals[dayKey] = dayHours;
        weeklyHours += dayHours;

        ensureBlockPaymentsDay(dayKey);
        ensureEarningsDay(dayKey);

        const blockPayArr = state.blockPayments[dayKey] || [0, 0, 0];
        const blockPayTotal = blockPayArr.reduce(
          (acc, v) => acc + (typeof v === "number" ? v : 0),
          0
        );

        const e = state.earnings[dayKey] || {};
        const amazonExtra = Number(e.amazon) || 0;
        const shipt = Number(e.shipt) || 0;
        const spark = Number(e.spark) || 0;
        const veho = Number(e.veho) || 0;
        const other = Number(e.other) || 0;
        const tips = Number(e.tips) || 0;

        const amazonTotalDay = blockPayTotal + amazonExtra;
        const apps = shipt + spark + veho + other;
        const dayMoney = amazonTotalDay + apps + tips;
        dayMoneyTotals[dayKey] = dayMoney;

        totalAmazon += amazonTotalDay;
        totalApps += apps;
        totalTips += tips;
      }

      const grandTotal = totalAmazon + totalApps + totalTips;
      const avgRate = weeklyHours > 0 ? grandTotal / weeklyHours : 0;

      return {
        weeklyHours,
        dayHoursTotals,
        dayMoneyTotals,
        totalAmazon,
        totalApps,
        totalTips,
        grandTotal,
        avgRate
      };
    }

    function recalcTotals() {
      const summary = computeSummary();

      document.querySelectorAll("[data-day-total-hours]").forEach(span => {
        const key = span.getAttribute("data-day-total-hours");
        const val = (summary.dayHoursTotals[key] || 0).toFixed(2).replace(/\.00$/, "");
        span.textContent = val;
      });

      document.querySelectorAll("[data-day-total-money]").forEach(span => {
        const key = span.getAttribute("data-day-total-money");
        const val = (summary.dayMoneyTotals[key] || 0).toFixed(2);
        span.textContent = "$" + val;
      });

      const used = summary.weeklyHours;
      const remaining = WEEK_LIMIT - used;

      usedHoursEl.textContent = used.toFixed(2).replace(/\.00$/, "");
      remainingHoursEl.textContent = (remaining > 0 ? remaining : 0)
        .toFixed(2)
        .replace(/\.00$/, "");

      warningTextEl.style.display = used > WEEK_LIMIT ? "inline" : "none";

      amazonTotalEl.textContent = "$" + summary.totalAmazon.toFixed(2);
      otherTotalEl.textContent = "$" + summary.totalApps.toFixed(2);
      cashTipsTotalEl.textContent = "$" + summary.totalTips.toFixed(2);
      grandTotalEl.textContent = "$" + summary.grandTotal.toFixed(2);

      avgRateEl.textContent = "$" + summary.avgRate.toFixed(2) + " / h";
    }

    /* =========================
       EXPORTAR CSV / PDF
    ==========================*/

    function exportToCSV() {
      const order = createDayOrder(state.startIndex);
      const summary = computeSummary();

      const header = [
        "Día",
        "Horas",
        "Amazon Flex (bloques + extra)",
        "Shipt",
        "Spark",
        "Veho",
        "Otros",
        "Tips efectivo",
        "Total día"
      ];

      const rows = [header];

      order.forEach(meta => {
        const dayKey = meta.key;
        ensureBlockPaymentsDay(dayKey);
        ensureEarningsDay(dayKey);

        const bp = state.blockPayments[dayKey] || [0, 0, 0];
        const blockPayTotal = bp.reduce(
          (acc, v) => acc + (typeof v === "number" ? v : 0),
          0
        );

        const e = state.earnings[dayKey] || {};
        const amazonExtra = Number(e.amazon) || 0;
        const shipt = Number(e.shipt) || 0;
        const spark = Number(e.spark) || 0;
        const veho = Number(e.veho) || 0;
        const other = Number(e.other) || 0;
        const tips = Number(e.tips) || 0;

        const amazonTotalDay = blockPayTotal + amazonExtra;
        const hours = summary.dayHoursTotals[dayKey] || 0;
        const totalDay = summary.dayMoneyTotals[dayKey] || 0;

        rows.push([
          meta.label,
          hours.toFixed(2),
          amazonTotalDay.toFixed(2),
          shipt.toFixed(2),
          spark.toFixed(2),
          veho.toFixed(2),
          other.toFixed(2),
          tips.toFixed(2),
          totalDay.toFixed(2)
        ]);
      });

      const csvLines = rows
        .map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(","))
        .join("\n");

      const blob = new Blob([csvLines], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "kairos-flex-semana.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function exportToPDF() {
      if (!window.jspdf || !window.jspdf.jsPDF) {
        alert("No se pudo cargar jsPDF. Verifica tu conexión a internet para generar el PDF.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "p",
        unit: "mm",
        format: "a4"
      });

      const summary = computeSummary();
      const order = createDayOrder(state.startIndex);

      const bgHeader = { r: 2, g: 6, b: 23 };
      const textLight = { r: 229, g: 231, b: 235 };
      const accent = { r: 34, g: 211, b: 238 };

      doc.setFillColor(bgHeader.r, bgHeader.g, bgHeader.b);
      doc.rect(0, 0, 210, 25, "F");
      doc.setTextColor(textLight.r, textLight.g, textLight.b);
      doc.setFontSize(16);
      doc.text("Kairos Flex – Reporte semanal", 10, 14);

      doc.setFontSize(10);
      const today = new Date();
      const startLabel = DAY_NAMES[state.startIndex];
      doc.text(
        `Semana iniciada en: ${startLabel} · Generado: ${today.toLocaleDateString()}`,
        10,
        20
      );

      let y = 30;
      doc.setTextColor(accent.r, accent.g, accent.b);
      doc.setFontSize(12);
      doc.text("Resumen general", 10, y);

      doc.setTextColor(255, 255, 255);
      doc.setFontSize(10);
      y += 6;

      doc.text(
        `Horas totales: ${summary.weeklyHours.toFixed(2)} h (límite 40 h)`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Ingresos Amazon Flex: $${summary.totalAmazon.toFixed(2)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Otros ingresos apps (Shipt, Spark, Veho, Otros): $${summary.totalApps.toFixed(2)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Propinas en efectivo: $${summary.totalTips.toFixed(2)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Total ingresos semana: $${summary.grandTotal.toFixed(2)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Promedio $/hora (total semana): $${summary.avgRate.toFixed(2)} / h`,
        10,
        y
      );

      if (summary.weeklyHours > WEEK_LIMIT) {
        y += 6;
        doc.setTextColor(249, 115, 129);
        doc.text("Aviso: has superado el límite de 40 h de Amazon Flex.", 10, y);
      }

      y += 10;
      if (y > 260) {
        doc.addPage();
        y = 20;
      }

      doc.setTextColor(accent.r, accent.g, accent.b);
      doc.setFontSize(12);
      doc.text("Detalle por día", 10, y);
      y += 6;

      doc.setFontSize(8);
      doc.setTextColor(200, 200, 200);

      const colX = {
        day: 10,
        hours: 38,
        amazon: 60,
        apps: 95,
        tips: 125,
        total: 155
      };

      doc.text("Día", colX.day, y);
      doc.text("Horas", colX.hours, y);
      doc.text("Amazon", colX.amazon, y);
      doc.text("Otras apps", colX.apps, y);
      doc.text("Tips", colX.tips, y);
      doc.text("Total día", colX.total, y);
      y += 4;

      doc.setDrawColor(55, 65, 81);
      doc.line(10, y, 200, y);
      y += 3;

      doc.setTextColor(230, 230, 230);

      order.forEach(meta => {
        const dayKey = meta.key;
        ensureBlockPaymentsDay(dayKey);
        ensureEarningsDay(dayKey);

        const bp = state.blockPayments[dayKey] || [0, 0, 0];
        const blockPayTotal = bp.reduce(
          (acc, v) => acc + (typeof v === "number" ? v : 0),
          0
        );

        const e = state.earnings[dayKey] || {};
        const amazonExtra = Number(e.amazon) || 0;
        const shipt = Number(e.shipt) || 0;
        const spark = Number(e.spark) || 0;
        const veho = Number(e.veho) || 0;
        const other = Number(e.other) || 0;
        const tips = Number(e.tips) || 0;

        const amazonTotalDay = blockPayTotal + amazonExtra;
        const apps = shipt + spark + veho + other;
        const hours = summary.dayHoursTotals[dayKey] || 0;
        const totalDay = summary.dayMoneyTotals[dayKey] || 0;

        const mode = state.modes[dayKey] || "flex";
        const labelMode = mode === "multi" ? "M" : "F";

        if (y > 270) {
          doc.addPage();
          y = 20;
        }

        doc.text(`${meta.label} (${labelMode})`, colX.day, y);
        doc.text(hours.toFixed(2), colX.hours, y, { align: "right" });
        doc.text(`$${amazonTotalDay.toFixed(2)}`, colX.amazon, y, { align: "right" });
        doc.text(`$${apps.toFixed(2)}`, colX.apps, y, { align: "right" });
        doc.text(`$${tips.toFixed(2)}`, colX.tips, y, { align: "right" });
        doc.text(`$${totalDay.toFixed(2)}`, colX.total, y, { align: "right" });

        y += 5;
      });

      doc.setFontSize(7);
      doc.setTextColor(148, 163, 184);
      doc.text(
        "Kairos Flex – Herramienta de control personal (no oficial de Amazon).",
        10,
        290
      );

      doc.save("kairos-flex-reporte-semanal.pdf");
    }

    /* =========================
       RENDER & INIT
    ==========================*/

    function renderWeek() {
      const order = createDayOrder(state.startIndex);
      daysContainer.innerHTML = "";

      order.forEach(dayMeta => {
        const card = createDayCard(dayMeta);
        daysContainer.appendChild(card);
      });

      startDaySelect.value = String(state.startIndex);
      recalcTotals();
    }

    function onStartDayChange(evt) {
      const idx = parseInt(evt.target.value, 10);
      if (isNaN(idx)) return;
      state.startIndex = idx;
      saveState();
      renderWeek();
    }

    function onResetWeek() {
      if (!confirm("¿Seguro que quieres reiniciar toda la semana? Esto pondrá todas las horas e ingresos en 0.")) {
        return;
      }
      state.blocks = {};
      state.blockPayments = {};
      state.earnings = {};
      state.modes = {};
      saveState();
      renderWeek();
    }

    function init() {
      // ahora sí: obtenemos el selector de tema DESPUÉS de que el DOM existe
      themeSelect = document.getElementById("themeSelect");
      if (themeSelect) {
        themeSelect.addEventListener("change", e => {
          applyTheme(e.target.value);
        });
      }

      loadTheme();   // aplica tema
      loadState();   // carga datos
      startDaySelect.addEventListener("change", onStartDayChange);
      resetWeekBtn.addEventListener("click", onResetWeek);
      exportCsvBtn.addEventListener("click", exportToCSV);
      exportPdfBtn.addEventListener("click", exportToPDF);
      renderWeek();
    }

    document.addEventListener("DOMContentLoaded", init);
  })();
</script>
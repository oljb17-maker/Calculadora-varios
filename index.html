<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kairos Flex â€“ Horas, Ingresos & Reporte</title>
<!-- PWA -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#020617">

<!-- Iconos -->
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root {
      /* Colores base (tema cyan por defecto) */
      --bg-body: radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.15), transparent 60%),
                 radial-gradient(circle at 100% 100%, rgba(94, 234, 212, 0.15), transparent 60%),
                 linear-gradient(135deg, #020617 0%, #020617 40%, #020617 100%);
      --bg-card: rgba(15, 23, 42, 0.9);
      --bg-card-alt: rgba(15, 23, 42, 0.98);

      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.2);
      --accent-border: rgba(34, 211, 238, 0.6);

      --text-main: #e5e7eb;
      --text-muted: #9ca3af;

      --border-soft: rgba(148, 163, 184, 0.4);
      --border-strong: rgba(148, 163, 184, 0.6);

      --error: #f97373;
      --green: #22c55e;
      --yellow: #facc15;
      --orange: #f97316;
      --pink: #f9a8d4;
    }

    /* TEMAS OSCUROS */
    body.theme-cyan {
      --bg-body: radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.15), transparent 60%),
                 radial-gradient(circle at 100% 100%, rgba(94, 234, 212, 0.15), transparent 60%),
                 linear-gradient(135deg, #020617 0%, #020617 40%, #020617 100%);
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.2);
      --accent-border: rgba(34, 211, 238, 0.6);
    }

    body.theme-red {
      --bg-body: radial-gradient(circle at 0% 0%, rgba(248, 113, 113, 0.12), transparent 60%),
                 radial-gradient(circle at 100% 100%, rgba(239, 68, 68, 0.12), transparent 60%),
                 linear-gradient(135deg, #020617 0%, #111827 40%, #1f2933 100%);
      --accent: #fb7185;
      --accent-soft: rgba(248, 113, 113, 0.2);
      --accent-border: rgba(248, 113, 113, 0.6);
    }

    body.theme-purple {
      --bg-body: radial-gradient(circle at 0% 0%, rgba(129, 140, 248, 0.14), transparent 60%),
                 radial-gradient(circle at 100% 100%, rgba(168, 85, 247, 0.16), transparent 60%),
                 linear-gradient(135deg, #020617 0%, #0b1020 40%, #181236 100%);
      --accent: #a855f7;
      --accent-soft: rgba(168, 85, 247, 0.22);
      --accent-border: rgba(168, 85, 247, 0.7);
    }

    body.theme-gray {
      --bg-body: radial-gradient(circle at 0% 0%, rgba(148, 163, 184, 0.15), transparent 60%),
                 radial-gradient(circle at 100% 100%, rgba(31, 41, 55, 0.4), transparent 60%),
                 linear-gradient(135deg, #020617 0%, #030712 40%, #020617 100%);
      --accent: #e5e7eb;
      --accent-soft: rgba(229, 231, 235, 0.18);
      --accent-border: rgba(229, 231, 235, 0.7);
    }

    /* TEMA CLARO */
    body.theme-light {
      --bg-body: linear-gradient(135deg, #e5e7eb 0%, #f9fafb 40%, #e5e7eb 100%);
      --bg-card: #ffffff;
      --bg-card-alt: #f9fafb;

      --text-main: #111827;
      --text-muted: #6b7280;

      --border-soft: rgba(148, 163, 184, 0.6);
      --border-strong: rgba(107, 114, 128, 0.95);

      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.12);
      --accent-border: rgba(37, 99, 235, 0.7);

      --error: #b91c1c;
      --green: #16a34a;
      --yellow: #ca8a04;
      --orange: #ea580c;
      --pink: #db2777;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
    }

    body {
      min-height: 100vh;
      background: var(--bg-body);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 1.2rem;
    }

    .app {
      width: 100%;
      max-width: 1180px;
      background: linear-gradient(145deg, var(--bg-card), rgba(15, 23, 42, 0.85));
      border-radius: 1.5rem;
      padding: 1.25rem 1.25rem 1.8rem;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.25);
      backdrop-filter: blur(16px);
    }

    body.theme-light .app {
      background: linear-gradient(145deg, #ffffff, #f3f4f6);
      box-shadow:
        0 20px 40px rgba(15, 23, 42, 0.15),
        0 0 0 1px rgba(209, 213, 219, 0.9);
    }

    @media (min-width: 768px) {
      .app {
        padding: 1.5rem 1.75rem 2rem;
      }
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1.25rem;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      min-width: 200px;
    }

    .app-title h1 {
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    @media (min-width: 768px) {
      .app-title h1 {
        font-size: 1.35rem;
      }
    }

    .badge {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      color: var(--accent);
      background: rgba(15, 23, 42, 0.7);
    }

    body.theme-light .badge {
      background: rgba(243, 244, 246, 0.9);
    }

    .app-title p {
      font-size: 0.85rem;
      color: var(--text-muted);
      max-width: 480px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      align-items: center;
      justify-content: flex-end;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .control-group label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.7rem;
    }

    select,
    button {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at 0% 0%, var(--accent-soft), rgba(15, 23, 42, 0.95));
      color: var(--text-main);
      padding: 0.4rem 0.9rem;
      font-size: 0.85rem;
      outline: none;
      transition: all 0.15s ease;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    body.theme-light select,
    body.theme-light button {
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
    }

    select:focus,
    button:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    button {
      cursor: pointer;
      font-weight: 500;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
    }

    body.theme-light button:hover {
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.15);
    }

    button.reset {
      border-color: rgba(248, 113, 113, 0.5);
      background: radial-gradient(circle at 100% 0%, rgba(248, 113, 113, 0.15), rgba(15, 23, 42, 0.95));
      color: #fecaca;
    }

    body.theme-light button.reset {
      color: #b91c1c;
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      border-color: #fecaca;
    }

    button.export {
      border-color: var(--accent-border);
      background: radial-gradient(circle at 50% 0%, var(--accent-soft), rgba(15, 23, 42, 0.95));
    }

    button.export-secondary {
      border-color: rgba(234, 179, 8, 0.6);
      background: radial-gradient(circle at 50% 0%, rgba(234, 179, 8, 0.2), rgba(15, 23, 42, 0.95));
    }

    .week-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.8rem;
      margin-bottom: 1.3rem;
    }

    @media (min-width: 640px) {
      .week-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 1024px) {
      .week-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .day-card {
      background: radial-gradient(circle at 0% 0%, var(--accent-soft), var(--bg-card));
      border-radius: 1rem;
      padding: 0.8rem 0.8rem 0.9rem;
      border: 1px solid var(--border-soft);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .day-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 120% -20%, rgba(94, 234, 212, 0.2), transparent 60%);
      opacity: 0.7;
      pointer-events: none;
    }

    body.theme-light .day-card::before {
      background: radial-gradient(circle at 120% -20%, rgba(191, 219, 254, 0.5), transparent 60%);
    }

    .day-header {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-bottom: 0.6rem;
      position: relative;
      z-index: 1;
    }

    .day-header-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.3rem;
    }

    .day-name {
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.7rem;
    }

    .mode-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .mode-btn {
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      padding: 0.1rem 0.55rem;
      font-size: 0.7rem;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      transition: all 0.15s ease;
    }

    body.theme-light .mode-btn {
      background: #e5e7eb;
      color: #111827;
    }

    .day-card.mode-flex .mode-btn {
      border-color: rgba(34, 197, 94, 0.8);
      background: radial-gradient(circle at 0% 0%, rgba(34, 197, 94, 0.3), var(--bg-card));
      color: #bbf7d0;
    }

    body.theme-light .day-card.mode-flex .mode-btn {
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #14532d;
    }

    .day-card.mode-multi .mode-btn {
      border-color: rgba(168, 85, 247, 0.9);
      background: radial-gradient(circle at 0% 0%, rgba(129, 140, 248, 0.4), var(--bg-card));
      color: #e0e7ff;
    }

    body.theme-light .day-card.mode-multi .mode-btn {
      background: linear-gradient(135deg, #ede9fe, #ddd6fe);
      color: #4c1d95;
    }

    .day-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .day-meta span strong {
      color: var(--accent);
    }

    .section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin: 0.25rem 0 0.15rem;
      position: relative;
      z-index: 1;
    }

    .blocks,
    .earnings {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      position: relative;
      z-index: 1;
    }

    .block-row,
    .earning-row {
      display: grid;
      gap: 0.3rem;
      align-items: center;
    }

    .block-row {
      grid-template-columns: 1.1fr 0.8fr 1fr;
    }

    .earning-row {
      grid-template-columns: 1.1fr 1fr;
    }

    .block-row label,
    .earning-row label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .block-row select,
    .block-row input,
    .earning-row input {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      padding: 0.25rem 0.6rem;
      font-size: 0.8rem;
      outline: none;
    }

    body.theme-light .block-row select,
    body.theme-light .block-row input,
    body.theme-light .earning-row input {
      background: #f9fafb;
    }

    .block-row select {
      text-align-last: right;
    }

    .block-row input,
    .earning-row input {
      text-align: right;
    }

    .block-row select:focus,
    .block-row input:focus,
    .earning-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .block-row input::placeholder,
    .earning-row input::placeholder {
      color: rgba(148, 163, 184, 0.7);
      font-size: 0.72rem;
    }

    .day-card.mode-flex .earnings .earning-row[data-non-amazon="true"] input {
      opacity: 0.6;
    }

    .summary {
      border-radius: 1rem;
      border: 1px solid var(--border-soft);
      padding: 0.9rem;
      background: radial-gradient(circle at 0% 100%, var(--accent-soft), var(--bg-card-alt));
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
      align-items: flex-start;
    }

    body.theme-light .summary {
      background: radial-gradient(circle at 0% 100%, rgba(219, 234, 254, 0.9), #ffffff);
    }

    @media (min-width: 768px) {
      .summary {
        padding: 1rem 1.1rem;
      }
    }

    .summary-main {
      display: flex;
      flex-wrap: wrap;
      gap: 1.3rem;
      align-items: center;
    }

    .summary-group {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      min-width: 180px;
    }

    .summary-item {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .summary-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .summary-value {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .summary-value.used {
      color: var(--accent);
    }

    .summary-value.remaining {
      color: #4ade80;
    }

    .summary-value.money-amazon {
      color: var(--green);
    }

    .summary-value.money-others {
      color: var(--yellow);
    }

    .summary-value.money-tips {
      color: var(--pink);
    }

    .summary-value.money-total {
      color: var(--orange);
    }

    .summary-cap {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .summary-warning {
      font-size: 0.8rem;
      color: var(--error);
    }

    .icon {
      font-size: 1rem;
    }

    .export-options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.2rem;
    }

    @media (max-width: 480px) {
      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .controls {
        width: 100%;
        justify-content: space-between;
      }

      .control-group {
        min-width: 145px;
      }

      .summary-main {
        flex-direction: column;
        gap: 0.8rem;
      }

      .block-row {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
      }

      .block-row label {
        grid-column: 1 / -1;
      }

      .block-row select,
      .block-row input {
        font-size: 0.78rem;
        padding: 0.2rem 0.55rem;
      }

      .day-header-top {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.15rem;
      }
    }

    button.loading {
      pointer-events: none;
      opacity: 0.7;
    }

    button.loading::after {
      content: " ...";
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0%, 20% { content: " ."; }
      40% { content: " .."; }
      60%, 100% { content: " ..."; }
    }
  </style>
</head>
<body class="theme-cyan">
  <div class="app">
    <header class="app-header">
      <div class="app-title">
        <h1>
          Kairos Flex
          <span class="badge">Horas Â· Ingresos Â· Reportes</span>
        </h1>
        <p>Calculadora semanal para Amazon Flex y multiapp (Shipt, Spark, Veho, otros) con tips en efectivo, modos por dÃ­a y exporte en PDF/CSV.</p>
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="themeSelect">Tema</label>
          <select id="themeSelect">
            <option value="cyan">Cyan / Negro</option>
            <option value="red">Rojo / Negro</option>
            <option value="purple">Morado / Negro</option>
            <option value="gray">Gris / Negro</option>
            <option value="light">Light / Claro</option>
          </select>
        </div>

        <div class="control-group">
          <label for="startDay">Inicio de semana</label>
          <select id="startDay">
            <option value="0">Domingo</option>
            <option value="1">Lunes</option>
            <option value="2">Martes</option>
            <option value="3">MiÃ©rcoles</option>
            <option value="4">Jueves</option>
            <option value="5">Viernes</option>
            <option value="6">SÃ¡bado</option>
          </select>
        </div>

        <div class="export-options">
          <button class="export" id="exportPdf" title="Generar reporte en PDF">
            <span class="icon">ðŸ“„</span> Exportar PDF
          </button>
          <button class="export-secondary" id="exportCsv" title="Exportar datos en formato CSV">
            <span class="icon">ðŸ“Š</span> Exportar CSV
          </button>
          <button class="export" id="exportJson" title="Backup en JSON">
            <span class="icon">ðŸ’¾</span> Backup datos
          </button>
          <button class="export-secondary" id="importJson" title="Importar backup JSON">
            <span class="icon">ðŸ“¥</span> Importar backup
          </button>
          <button class="reset" id="resetWeek">
            <span class="icon">ðŸ§¹</span> Reiniciar semana
          </button>
        </div>
      </div>
    </header>

    <main>
      <section class="week-grid" id="daysContainer">
        <!-- DÃ­as dinÃ¡micos -->
      </section>

      <section class="summary">
        <div class="summary-main">
          <div class="summary-group">
            <div class="summary-item">
              <span class="summary-label">Horas acumuladas</span>
              <span class="summary-value used" id="usedHours">0</span>
              <span class="summary-cap">de 40 h disponibles</span>
            </div>

            <div class="summary-item">
              <span class="summary-label">Horas restantes</span>
              <span class="summary-value remaining" id="remainingHours">40</span>
            </div>

            <div class="summary-item">
              <span class="summary-label">Promedio $/hora (total semana)</span>
              <span class="summary-value" id="avgRate">$0.00 / h</span>
            </div>
          </div>

          <div class="summary-group">
            <div class="summary-item">
              <span class="summary-label">Ingresos Amazon Flex (semana)</span>
              <span class="summary-value money-amazon" id="amazonTotal">$0.00</span>
            </div>

            <div class="summary-item">
              <span class="summary-label">Otros ingresos apps (Shipt, Spark, Veho, Otros)</span>
              <span class="summary-value money-others" id="otherTotal">$0.00</span>
            </div>

            <div class="summary-item">
              <span class="summary-label">Propinas en efectivo (semana)</span>
              <span class="summary-value money-tips" id="cashTipsTotal">$0.00</span>
            </div>

            <div class="summary-item">
              <span class="summary-label">Total ingresos semana</span>
              <span class="summary-value money-total" id="grandTotal">$0.00</span>
            </div>
          </div>
        </div>

        <div class="summary-item">
          <span class="summary-label">Nota</span>
          <span class="summary-cap">
            Esta herramienta es solo una ayuda visual para tus bloques e ingresos. No estÃ¡ conectada a Amazon ni a otras apps.
          </span>
          <span class="summary-warning" id="warningText" style="display:none;">
            Has superado el lÃ­mite de 40 h. Revisa tus bloques.
          </span>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    (function () {
      const STORAGE_KEY = "kairosFlexWeeklyHoursIncomeModes_v5";
      const THEME_KEY = "kairosFlexTheme_v1";
      const WEEK_LIMIT = 40;

      const DAY_NAMES = [
        "Domingo",
        "Lunes",
        "Martes",
        "MiÃ©rcoles",
        "Jueves",
        "Viernes",
        "SÃ¡bado"
      ];

      const themeSelect = document.getElementById("themeSelect");
      const startDaySelect = document.getElementById("startDay");
      const daysContainer = document.getElementById("daysContainer");
      const usedHoursEl = document.getElementById("usedHours");
      const remainingHoursEl = document.getElementById("remainingHours");
      const warningTextEl = document.getElementById("warningText");

      const amazonTotalEl = document.getElementById("amazonTotal");
      const otherTotalEl = document.getElementById("otherTotal");
      const cashTipsTotalEl = document.getElementById("cashTipsTotal");
      const grandTotalEl = document.getElementById("grandTotal");
      const avgRateEl = document.getElementById("avgRate");

      const resetWeekBtn = document.getElementById("resetWeek");
      const exportPdfBtn = document.getElementById("exportPdf");
      const exportCsvBtn = document.getElementById("exportCsv");
      const exportJsonBtn = document.getElementById("exportJson");
      const importJsonBtn = document.getElementById("importJson");

      let state = {
        startIndex: 0,
        blocks: {},
        blockPayments: {},
        earnings: {},
        modes: {}
      };

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            state = {
              ...state,
              ...parsed
            };
            if (!state.blocks) state.blocks = {};
            if (!state.blockPayments) state.blockPayments = {};
            if (!state.earnings) state.earnings = {};
            if (!state.modes) state.modes = {};
          }
        } catch (e) {
          console.warn("No se pudo cargar el estado:", e);
        }
      }

      function saveState() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
          console.warn("No se pudo guardar el estado:", e);
        }
      }

      function applyTheme(theme) {
        const body = document.body;
        body.classList.remove("theme-cyan", "theme-red", "theme-purple", "theme-gray", "theme-light");
        const selected = theme || "cyan";
        body.classList.add("theme-" + selected);
      }

      function loadTheme() {
        const saved = localStorage.getItem(THEME_KEY) || "cyan";
        if (themeSelect) themeSelect.value = saved;
        applyTheme(saved);
      }

      function onThemeChange(e) {
        const t = e.target.value || "cyan";
        localStorage.setItem(THEME_KEY, t);
        applyTheme(t);
      }

      function createDayOrder(startIndex) {
        const order = [];
        for (let i = 0; i < 7; i++) {
          const idx = (startIndex + i) % 7;
          order.push({
            realIndex: idx,
            label: DAY_NAMES[idx],
            key: "day_" + idx
          });
        }
        return order;
      }

      function applyModeStyle(card, dayKey) {
        const mode = state.modes[dayKey] || "flex";
        card.classList.remove("mode-flex", "mode-multi");
        if (mode === "multi") {
          card.classList.add("mode-multi");
        } else {
          card.classList.add("mode-flex");
        }
        const btn = card.querySelector(".mode-btn");
        if (btn) {
          btn.textContent = mode === "multi" ? "Multiapp" : "Solo Flex";
        }
      }

      function ensureEarningsDay(dayKey) {
        if (!state.earnings[dayKey]) {
          state.earnings[dayKey] = {
            amazon: 0,
            shipt: 0,
            spark: 0,
            veho: 0,
            other: 0,
            tips: 0
          };
        } else {
          const e = state.earnings[dayKey];
          if (typeof e.amazon !== "number") e.amazon = 0;
          if (typeof e.shipt !== "number") e.shipt = 0;
          if (typeof e.spark !== "number") e.spark = 0;
          if (typeof e.veho !== "number") e.veho = 0;
          if (typeof e.other !== "number") e.other = 0;
          if (typeof e.tips !== "number") e.tips = 0;
        }
      }

      function ensureBlockPaymentsDay(dayKey) {
        if (!state.blockPayments[dayKey]) {
          state.blockPayments[dayKey] = [0, 0, 0];
        } else if (!Array.isArray(state.blockPayments[dayKey])) {
          state.blockPayments[dayKey] = [0, 0, 0];
        } else {
          const arr = state.blockPayments[dayKey];
          for (let i = 0; i < 3; i++) {
            if (typeof arr[i] !== "number") arr[i] = 0;
          }
        }
      }

      function showLoading(button) {
        const originalText = button.textContent;
        button.disabled = true;
        button.classList.add("loading");
        return originalText;
      }

      function hideLoading(button, originalText) {
        button.disabled = false;
        button.classList.remove("loading");
        button.textContent = originalText;
      }

      function formatNumber(value, decimals = 2) {
        return parseFloat(value || 0).toFixed(decimals);
      }

      function createDayCard(dayMeta) {
        const card = document.createElement("article");
        card.className = "day-card";
        card.dataset.dayKey = dayMeta.key;

        const currentMode = state.modes[dayMeta.key] || "flex";
        state.modes[dayMeta.key] = currentMode;

        const header = document.createElement("div");
        header.className = "day-header";

        const headerTop = document.createElement("div");
        headerTop.className = "day-header-top";

        const name = document.createElement("div");
        name.className = "day-name";
        name.textContent = dayMeta.label;

        const modeToggle = document.createElement("div");
        modeToggle.className = "mode-toggle";

        const modeLabel = document.createElement("span");
        modeLabel.className = "mode-label";
        modeLabel.textContent = "Modo";

        const modeBtn = document.createElement("button");
        modeBtn.type = "button";
        modeBtn.className = "mode-btn";
        modeBtn.dataset.dayMode = dayMeta.key;

        modeToggle.appendChild(modeLabel);
        modeToggle.appendChild(modeBtn);
        headerTop.appendChild(name);
        headerTop.appendChild(modeToggle);

        const headerMeta = document.createElement("div");
        headerMeta.className = "day-meta";
        headerMeta.innerHTML = `
          <span>Horas: <strong data-day-total-hours="${dayMeta.key}">0</strong> h</span>
          <span>Ingresos: <strong data-day-total-money="${dayMeta.key}">$0.00</strong></span>
        `;

        header.appendChild(headerTop);
        header.appendChild(headerMeta);

        const blocksSectionLabel = document.createElement("div");
        blocksSectionLabel.className = "section-label";
        blocksSectionLabel.textContent = "Bloques de horas (Flex)";

        const blocks = document.createElement("div");
        blocks.className = "blocks";

        const hourLabels = ["Madrugada", "Tarde", "Noche"];
        const savedBlocks = state.blocks[dayMeta.key];
        const savedBlockPayments = state.blockPayments[dayMeta.key];

        hourLabels.forEach((lbl, idx) => {
          const row = document.createElement("div");
          row.className = "block-row";

          const lab = document.createElement("label");
          lab.textContent = lbl;

          const select = document.createElement("select");
          select.dataset.dayKey = dayMeta.key;
          select.dataset.blockIndex = String(idx);

          const options = [
  { label: "0 h", value: "" },
  { label: "2 h", value: "2" },
  { label: "2.5 h", value: "2.5" },
  { label: "3 h", value: "3" },
  { label: "3.5 h", value: "3.5" },
  { label: "4 h", value: "4" },
  { label: "4.5 h", value: "4.5" },
  { label: "5 h", value: "5" }
];

          options.forEach(opt => {
            const optionEl = document.createElement("option");
            optionEl.value = opt.value;
            optionEl.textContent = opt.label;
            select.appendChild(optionEl);
          });

          if (Array.isArray(savedBlocks) && typeof savedBlocks[idx] === "number" && savedBlocks[idx] > 0) {
            select.value = String(savedBlocks[idx]);
          }

          select.addEventListener("change", onHoursSelectChange);

          const priceInput = document.createElement("input");
          priceInput.type = "number";
          priceInput.min = "0";
          priceInput.step = "0.01";
          priceInput.placeholder = "$0.00";
          priceInput.dataset.dayKey = dayMeta.key;
          priceInput.dataset.blockIndex = String(idx);

          if (Array.isArray(savedBlockPayments) && typeof savedBlockPayments[idx] === "number") {
            priceInput.value = savedBlockPayments[idx];
          }

          priceInput.addEventListener("input", onBlockPriceInput);

          row.appendChild(lab);
          row.appendChild(select);
          row.appendChild(priceInput);
          blocks.appendChild(row);
        });

        const earningsSectionLabel = document.createElement("div");
        earningsSectionLabel.className = "section-label";
        earningsSectionLabel.textContent = "Ingresos del dÃ­a";

        const earnings = document.createElement("div");
        earnings.className = "earnings";

        const earningFields = [
          { key: "amazon", label: "Amazon Flex (extra/ajustes)", nonAmazon: false },
          { key: "shipt", label: "Shipt", nonAmazon: true },
          { key: "spark", label: "Spark", nonAmazon: true },
          { key: "veho", label: "Veho", nonAmazon: true },
          { key: "other", label: "Otros", nonAmazon: true },
          { key: "tips", label: "Tips efectivo", nonAmazon: true }
        ];

        const savedEarnings = state.earnings[dayMeta.key] || {};

        earningFields.forEach(field => {
          const row = document.createElement("div");
          row.className = "earning-row";
          if (field.nonAmazon) {
            row.dataset.nonAmazon = "true";
          }

          const lab = document.createElement("label");
          lab.textContent = field.label;

          const input = document.createElement("input");
          input.type = "number";
          input.min = "0";
          input.step = "0.01";
          input.placeholder = "0.00";
          input.dataset.dayKey = dayMeta.key;
          input.dataset.earningKey = field.key;

          if (savedEarnings && typeof savedEarnings[field.key] === "number") {
            input.value = savedEarnings[field.key];
          }

          input.addEventListener("input", onEarningInput);

          row.appendChild(lab);
          row.appendChild(input);
          earnings.appendChild(row);
        });

        card.appendChild(header);
        card.appendChild(blocksSectionLabel);
        card.appendChild(blocks);
        card.appendChild(earningsSectionLabel);
        card.appendChild(earnings);

        modeBtn.addEventListener("click", () => {
          const current = state.modes[dayMeta.key] || "flex";
          const next = current === "flex" ? "multi" : "flex";
          state.modes[dayMeta.key] = next;
          applyModeStyle(card, dayMeta.key);
          saveState();
        });

        applyModeStyle(card, dayMeta.key);

        return card;
      }

      function onHoursSelectChange(evt) {
        const select = evt.target;
        const dayKey = select.dataset.dayKey;
        const blockIndex = parseInt(select.dataset.blockIndex, 10);

        if (!state.blocks[dayKey]) {
          state.blocks[dayKey] = [0, 0, 0];
        }

        let val = 0;
        if (select.value !== "") {
          const num = parseFloat(select.value);
          if (!isNaN(num) && num > 0 && num <= 8) {
            val = num;
          } else {
            select.value = "";
            val = 0;
          }
        }

        state.blocks[dayKey][blockIndex] = val;
        recalcTotals();
        saveState();
      }

      function onBlockPriceInput(evt) {
        const input = evt.target;
        const dayKey = input.dataset.dayKey;
        const blockIndex = parseInt(input.dataset.blockIndex, 10);

        ensureBlockPaymentsDay(dayKey);

        let valueStr = String(input.value || "").replace(",", ".");
        let val = parseFloat(valueStr);
        if (isNaN(val) || val < 0) val = 0;
        if (val > 10000) val = 10000;

        state.blockPayments[dayKey][blockIndex] = val;
        recalcTotals();
        saveState();
      }

      function onEarningInput(evt) {
        const input = evt.target;
        const dayKey = input.dataset.dayKey;
        const earningKey = input.dataset.earningKey;

        ensureEarningsDay(dayKey);

        let valueStr = String(input.value || "").replace(",", ".");
        let val = parseFloat(valueStr);
        if (isNaN(val) || val < 0) val = 0;
        if (val > 10000) val = 10000;

        state.earnings[dayKey][earningKey] = val;
        recalcTotals();
        saveState();
      }

      function computeSummary() {
        let weeklyHours = 0;
        const dayHoursTotals = {};
        const dayMoneyTotals = {};

        let totalAmazon = 0;
        let totalApps = 0;
        let totalTips = 0;

        for (let i = 0; i < 7; i++) {
          const dayKey = "day_" + i;

          const blocks = state.blocks[dayKey] || [0, 0, 0];
          const dayHours = blocks.reduce(
            (acc, v) => acc + (typeof v === "number" ? v : 0),
            0
          );
          dayHoursTotals[dayKey] = dayHours;
          weeklyHours += dayHours;

          ensureBlockPaymentsDay(dayKey);
          ensureEarningsDay(dayKey);

          const blockPayArr = state.blockPayments[dayKey] || [0, 0, 0];
          const blockPayTotal = blockPayArr.reduce(
            (acc, v) => acc + (typeof v === "number" ? v : 0),
            0
          );

          const e = state.earnings[dayKey] || {};
          const amazonExtra = Number(e.amazon) || 0;
          const shipt = Number(e.shipt) || 0;
          const spark = Number(e.spark) || 0;
          const veho = Number(e.veho) || 0;
          const other = Number(e.other) || 0;
          const tips = Number(e.tips) || 0;

          const amazonTotalDay = blockPayTotal + amazonExtra;
          const apps = shipt + spark + veho + other;
          const dayMoney = amazonTotalDay + apps + tips;
          dayMoneyTotals[dayKey] = dayMoney;

          totalAmazon += amazonTotalDay;
          totalApps += apps;
          totalTips += tips;
        }

        const grandTotal = totalAmazon + totalApps + totalTips;
        const avgRate = weeklyHours > 0 ? grandTotal / weeklyHours : 0;

        return {
          weeklyHours,
          dayHoursTotals,
          dayMoneyTotals,
          totalAmazon,
          totalApps,
          totalTips,
          grandTotal,
          avgRate
        };
      }

      function recalcTotals() {
        const summary = computeSummary();

        document.querySelectorAll("[data-day-total-hours]").forEach(span => {
          const key = span.getAttribute("data-day-total-hours");
          const val = formatNumber(summary.dayHoursTotals[key], 1);
          span.textContent = val.replace(/\.0$/, "");
        });

        document.querySelectorAll("[data-day-total-money]").forEach(span => {
          const key = span.getAttribute("data-day-total-money");
          const val = formatNumber(summary.dayMoneyTotals[key] || 0);
          span.textContent = "$" + val;
        });

        const used = summary.weeklyHours;
        const remaining = WEEK_LIMIT - used;

        usedHoursEl.textContent = formatNumber(used, 1).replace(/\.0$/, "");
        remainingHoursEl.textContent = (remaining > 0 ? remaining : 0)
          .toFixed(1)
          .replace(/\.0$/, "");

        warningTextEl.style.display = used > WEEK_LIMIT ? "inline" : "none";

        amazonTotalEl.textContent = "$" + formatNumber(summary.totalAmazon);
        otherTotalEl.textContent = "$" + formatNumber(summary.totalApps);
        cashTipsTotalEl.textContent = "$" + formatNumber(summary.totalTips);
        grandTotalEl.textContent = "$" + formatNumber(summary.grandTotal);

        avgRateEl.textContent = "$" + formatNumber(summary.avgRate) + " / h";
      }

      function onStartDayChange(evt) {
        const idx = parseInt(evt.target.value, 10);
        if (isNaN(idx)) return;
        state.startIndex = idx;
        saveState();
        renderWeek();
      }

      function onResetWeek() {
        if (!confirm("Â¿Seguro que quieres reiniciar toda la semana? Esto pondrÃ¡ todas las horas e ingresos en 0.")) {
          return;
        }
        state.blocks = {};
        state.blockPayments = {};
        state.earnings = {};
        state.modes = {};
        saveState();
        renderWeek();
      }

      function exportToCSV() {
        const originalText = showLoading(exportCsvBtn);
        setTimeout(() => {
          try {
            const order = createDayOrder(state.startIndex);
            const summary = computeSummary();

            const header = [
              "DÃ­a",
              "Horas",
              "Amazon Flex (bloques + extra)",
              "Shipt",
              "Spark",
              "Veho",
              "Otros",
              "Tips efectivo",
              "Total dÃ­a"
            ];

            const rows = [header];

            order.forEach(meta => {
              const dayKey = meta.key;
              ensureBlockPaymentsDay(dayKey);
              ensureEarningsDay(dayKey);

              const bp = state.blockPayments[dayKey] || [0, 0, 0];
              const blockPayTotal = bp.reduce(
                (acc, v) => acc + (typeof v === "number" ? v : 0),
                0
              );

              const e = state.earnings[dayKey] || {};
              const amazonExtra = Number(e.amazon) || 0;
              const shipt = Number(e.shipt) || 0;
              const spark = Number(e.spark) || 0;
              const veho = Number(e.veho) || 0;
              const other = Number(e.other) || 0;
              const tips = Number(e.tips) || 0;

              const amazonTotalDay = blockPayTotal + amazonExtra;
              const hours = summary.dayHoursTotals[dayKey] || 0;
              const totalDay = summary.dayMoneyTotals[dayKey] || 0;

              rows.push([
                meta.label,
                formatNumber(hours, 1),
                formatNumber(amazonTotalDay),
                formatNumber(shipt),
                formatNumber(spark),
                formatNumber(veho),
                formatNumber(other),
                formatNumber(tips),
                formatNumber(totalDay)
              ]);
            });

            const csvLines = rows
              .map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(","))
              .join("\n");

            const blob = new Blob([csvLines], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "kairos-flex-semana.csv";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          } catch (error) {
            console.error("Error al generar CSV:", error);
            alert("Error al generar el CSV. Intenta nuevamente.");
          } finally {
            hideLoading(exportCsvBtn, originalText);
          }
        }, 400);
      }

      function exportToJSON() {
        const originalText = showLoading(exportJsonBtn);
        setTimeout(() => {
          try {
            const exportData = {
              ...state,
              exportDate: new Date().toISOString(),
              version: "kairos-flex-v1"
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const hoy = new Date();
const yyyy = hoy.getFullYear();
const mm = String(hoy.getMonth() + 1).padStart(2, "0");
const dd = String(hoy.getDate()).padStart(2, "0");
const hh = String(hoy.getHours()).padStart(2, "0");
const min = String(hoy.getMinutes()).padStart(2, "0");

const fileName = `kairos-flex-backup-${yyyy}-${mm}-${dd}_${hh}-${min}.json`;

const link = document.createElement("a");
link.href = url;
link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          } catch (error) {
            console.error("Error al generar JSON:", error);
            alert("Error al generar el JSON. Intenta nuevamente.");
          } finally {
            hideLoading(exportJsonBtn, originalText);
          }
        }, 400);
      }

      function importFromJSON() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json,application/json";
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = event => {
            try {
              const importedState = JSON.parse(event.target.result);
              if (importedState && typeof importedState === "object") {
                state = {
                  ...state,
                  ...importedState
                };
                if (!state.blocks) state.blocks = {};
                if (!state.blockPayments) state.blockPayments = {};
                if (!state.earnings) state.earnings = {};
                if (!state.modes) state.modes = {};
                if (typeof state.startIndex !== "number") state.startIndex = 0;

                saveState();
                renderWeek();
                alert("Backup importado correctamente.");
              } else {
                alert("El archivo no contiene una configuraciÃ³n vÃ¡lida.");
              }
            } catch (error) {
              console.error("Error al importar JSON:", error);
              alert("Error al importar el archivo. AsegÃºrate de que es un JSON vÃ¡lido.");
            }
          };
          reader.readAsText(file);
        };
        input.click();
      }

      function exportToPDF() {
  const originalText = showLoading(exportPdfBtn);
  setTimeout(() => {
    try {
      if (!window.jspdf || !window.jspdf.jsPDF) {
        alert("No se pudo cargar jsPDF. Verifica tu conexiÃ³n a internet para generar el PDF.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "p",
        unit: "mm",
        format: "a4"
      });

      const summary = computeSummary();
      const order = createDayOrder(state.startIndex);

      // Colores estilo app (dark)
      const bgBody   = { r: 2,  g: 6,   b: 23 };  // fondo general
      const bgHeader = { r: 15, g: 23,  b: 42 };  // barra superior
      const textMain = { r: 226, g: 232, b: 240 }; // texto principal (claro)
      const textMuted= { r: 148, g: 163, b: 184 }; // texto secundario
      const accent   = { r: 56,  g: 189, b: 248 }; // cyan

      // Fondo oscuro en toda la pÃ¡gina
      doc.setFillColor(bgBody.r, bgBody.g, bgBody.b);
      doc.rect(0, 0, 210, 297, "F");

      // Header
      doc.setFillColor(bgHeader.r, bgHeader.g, bgHeader.b);
      doc.rect(0, 0, 210, 25, "F");

      doc.setTextColor(textMain.r, textMain.g, textMain.b);
      doc.setFontSize(16);
      doc.text("Kairos Flex â€“ Reporte semanal", 10, 14);

      doc.setFontSize(10);
      const today = new Date();
      const startLabel = DAY_NAMES[state.startIndex];
      doc.setTextColor(textMuted.r, textMuted.g, textMuted.b);
      doc.text(
        `Semana iniciada en: ${startLabel} Â· Generado: ${today.toLocaleDateString()}`,
        10,
        20
      );

      let y = 32;

      // TÃ­tulo "Resumen general"
      doc.setTextColor(accent.r, accent.g, accent.b);
      doc.setFontSize(12);
      doc.text("Resumen general", 10, y);

      // Datos resumen
      y += 7;
      doc.setFontSize(10);
      doc.setTextColor(textMain.r, textMain.g, textMain.b);

      doc.text(
        `Horas totales: ${formatNumber(summary.weeklyHours, 1)} h (lÃ­mite 40 h)`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Ingresos Amazon Flex: $${formatNumber(summary.totalAmazon)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Otros ingresos apps (Shipt, Spark, Veho, Otros): $${formatNumber(summary.totalApps)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Propinas en efectivo: $${formatNumber(summary.totalTips)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Total ingresos semana: $${formatNumber(summary.grandTotal)}`,
        10,
        y
      );
      y += 5;
      doc.text(
        `Promedio $/hora (total semana): $${formatNumber(summary.avgRate)} / h`,
        10,
        y
      );

      if (summary.weeklyHours > WEEK_LIMIT) {
        y += 6;
        doc.setTextColor(248, 113, 113); // rojo suave
        doc.text("Aviso: has superado el lÃ­mite de 40 h de Amazon Flex.", 10, y);
      }

      // SecciÃ³n detalle por dÃ­a
      y += 10;
      if (y > 260) {
        doc.addPage();
        // repetir fondo dark en la nueva pÃ¡gina
        doc.setFillColor(bgBody.r, bgBody.g, bgBody.b);
        doc.rect(0, 0, 210, 297, "F");
        y = 20;
      }

      doc.setTextColor(accent.r, accent.g, accent.b);
      doc.setFontSize(12);
      doc.text("Detalle por dÃ­a", 10, y);
      y += 6;

      doc.setFontSize(8);
      doc.setTextColor(textMuted.r, textMuted.g, textMuted.b);

      const colX = {
        day: 10,
        hours: 38,
        amazon: 60,
        apps: 95,
        tips: 125,
        total: 155
      };

      doc.text("DÃ­a", colX.day, y);
      doc.text("Horas", colX.hours, y);
      doc.text("Amazon", colX.amazon, y);
      doc.text("Otras apps", colX.apps, y);
      doc.text("Tips", colX.tips, y);
      doc.text("Total dÃ­a", colX.total, y);
      y += 3;

      doc.setDrawColor(55, 65, 81);
      doc.line(10, y, 200, y);
      y += 3;

      doc.setTextColor(textMain.r, textMain.g, textMain.b);

      order.forEach(meta => {
        const dayKey = meta.key;
        ensureBlockPaymentsDay(dayKey);
        ensureEarningsDay(dayKey);

        const bp = state.blockPayments[dayKey] || [0, 0, 0];
        const blockPayTotal = bp.reduce(
          (acc, v) => acc + (typeof v === "number" ? v : 0),
          0
        );

        const e = state.earnings[dayKey] || {};
        const amazonExtra = Number(e.amazon) || 0;
        const shipt = Number(e.shipt) || 0;
        const spark = Number(e.spark) || 0;
        const veho = Number(e.veho) || 0;
        const other = Number(e.other) || 0;
        const tips = Number(e.tips) || 0;

        const amazonTotalDay = blockPayTotal + amazonExtra;
        const apps = shipt + spark + veho + other;
        const hours = summary.dayHoursTotals[dayKey] || 0;
        const totalDay = summary.dayMoneyTotals[dayKey] || 0;

        const mode = state.modes[dayKey] || "flex";
        const labelMode = mode === "multi" ? "M" : "F";

        if (y > 270) {
          doc.addPage();
          doc.setFillColor(bgBody.r, bgBody.g, bgBody.b);
          doc.rect(0, 0, 210, 297, "F");
          y = 20;
          doc.setFontSize(8);
          doc.setTextColor(textMuted.r, textMuted.g, textMuted.b);
          doc.text("DÃ­a", colX.day, y);
          doc.text("Horas", colX.hours, y);
          doc.text("Amazon", colX.amazon, y);
          doc.text("Otras apps", colX.apps, y);
          doc.text("Tips", colX.tips, y);
          doc.text("Total dÃ­a", colX.total, y);
          y += 3;
          doc.setDrawColor(55, 65, 81);
          doc.line(10, y, 200, y);
          y += 3;
          doc.setTextColor(textMain.r, textMain.g, textMain.b);
        }

        doc.text(`${meta.label} (${labelMode})`, colX.day, y);
        doc.text(formatNumber(hours, 1), colX.hours, y, { align: "right" });
        doc.text(`$${formatNumber(amazonTotalDay)}`, colX.amazon, y, { align: "right" });
        doc.text(`$${formatNumber(apps)}`, colX.apps, y, { align: "right" });
        doc.text(`$${formatNumber(tips)}`, colX.tips, y, { align: "right" });
        doc.text(`$${formatNumber(totalDay)}`, colX.total, y, { align: "right" });

        y += 4.5;
      });

      // Footer
      doc.setFontSize(7);
      doc.setTextColor(textMuted.r, textMuted.g, textMuted.b);
      doc.text(
        "Kairos Flex â€“ Herramienta de control personal (no oficial de Amazon).",
        10,
        290
      );

      doc.save("kairos-flex-reporte-semanal.pdf");
    } catch (error) {
      console.error("Error al generar PDF:", error);
      alert("Error al generar el PDF. Intenta nuevamente.");
    } finally {
      hideLoading(exportPdfBtn, originalText);
    }
  }, 400);
}
      function renderWeek() {
        const order = createDayOrder(state.startIndex);
        daysContainer.innerHTML = "";

        order.forEach(dayMeta => {
          const card = createDayCard(dayMeta);
          daysContainer.appendChild(card);
        });

        startDaySelect.value = String(state.startIndex);
        recalcTotals();
      }

      function init() {
        loadState();
        loadTheme();

        if (themeSelect) themeSelect.addEventListener("change", onThemeChange);
        if (startDaySelect) startDaySelect.addEventListener("change", onStartDayChange);
        if (resetWeekBtn) resetWeekBtn.addEventListener("click", onResetWeek);
        if (exportCsvBtn) exportCsvBtn.addEventListener("click", exportToCSV);
        if (exportPdfBtn) exportPdfBtn.addEventListener("click", exportToPDF);
        if (exportJsonBtn) exportJsonBtn.addEventListener("click", exportToJSON);
        if (importJsonBtn) importJsonBtn.addEventListener("click", importFromJSON);

        renderWeek();
      }

      // Llamamos init directamente
      init();
    })();
  </script>
  <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js")
      .catch(err => console.log("SW error:", err));
  });
}
</script>
</body>
</html>